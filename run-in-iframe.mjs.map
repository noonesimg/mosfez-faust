{"version":3,"file":"run-in-iframe.mjs","sources":["../src/run-in-iframe.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport runInIframeInnerStringified from \"../dist/iframe/run-in-iframe-inner.stringify.js\";\n\nexport type RunInIframeConfig = {\n  functionString: string;\n  params: unknown;\n  transferrables?: Transferable[];\n};\n\nexport type RunInIframeInnerResult = [unknown] | [unknown, Transferable[]];\n\nexport async function runInIframe(\n  options: RunInIframeConfig\n): Promise<unknown> {\n  const { functionString, params, transferrables = [] } = options;\n  const iframe = document.createElement(\"iframe\");\n  iframe.style.display = \"none\";\n  document.body.append(iframe);\n  const { contentWindow } = iframe;\n\n  if (!contentWindow) throw new Error(`contentWindow not available on iframe`);\n\n  contentWindow.document.write(\n    `<script>\n      var exports = {};\n      ${functionString}\n      ${runInIframeInnerStringified}\n      exports.runInIframeInner(exports.run);\n    </script>`\n  );\n\n  return new Promise((resolve) => {\n    const messageListener = (message: MessageEvent) => {\n      if (message.source !== contentWindow) return;\n\n      window.removeEventListener(\"message\", messageListener);\n      iframe.remove();\n      resolve(message.data);\n    };\n    window.addEventListener(\"message\", messageListener);\n\n    contentWindow.postMessage(params, window.location.origin, transferrables);\n  });\n}\n"],"names":[],"mappings":";;AACO,eAAe,WAAW,CAAC,OAAO,EAAE;AAC3C,EAAE,MAAM,EAAE,cAAc,EAAE,MAAM,EAAE,cAAc,GAAG,EAAE,EAAE,GAAG,OAAO,CAAC;AAClE,EAAE,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAClD,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;AAChC,EAAE,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAC/B,EAAE,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,CAAC;AACnC,EAAE,IAAI,CAAC,aAAa;AACpB,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,qCAAqC,CAAC,CAAC,CAAC;AAC7D,EAAE,aAAa,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AAChC;AACA,MAAM,EAAE,cAAc,CAAC;AACvB,MAAM,EAAE,2BAA2B,CAAC;AACpC;AACA,cAAc,CAAC,CAAC,CAAC;AACjB,EAAE,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,KAAK;AAClC,IAAI,MAAM,eAAe,GAAG,CAAC,OAAO,KAAK;AACzC,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,aAAa;AAC1C,QAAQ,OAAO;AACf,MAAM,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;AAC7D,MAAM,MAAM,CAAC,MAAM,EAAE,CAAC;AACtB,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC5B,KAAK,CAAC;AACN,IAAI,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;AACxD,IAAI,aAAa,CAAC,WAAW,CAAC,MAAM,EAAE,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;AAC9E,GAAG,CAAC,CAAC;AACL;;;;"}